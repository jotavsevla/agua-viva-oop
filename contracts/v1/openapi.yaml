openapi: 3.0.3
info:
  title: Agua Viva API Contracts
  version: 1.0.0
  description: |
    Contrato canonico compartilhado entre Time A (core operacional)
    e Time B (produto/UI).

servers:
  - url: http://localhost:8081
    description: Java API local

paths:
  /health:
    get:
      summary: Health check da API
      tags: [infra]
      responses:
        '200':
          description: API e banco online
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  database:
                    type: string
                    example: ok
                required: [status, database]
        '503':
          description: API online, mas sem conectividade com banco
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: degraded
                  database:
                    type: string
                    example: down
                required: [status, database]

  /api/atendimento/pedidos:
    post:
      summary: Registrar pedido de atendimento telefonico
      tags: [atendimento]
      parameters:
        - name: Idempotency-Key
          in: header
          required: false
          schema:
            type: string
            maxLength: 128
          description: |
            Chave opcional de idempotencia para atendimento manual quando manualRequestId nao for enviado.
            Tambem aceita o alias X-Idempotency-Key.
            Quando ambos os headers sao enviados, devem possuir o mesmo valor.
            Em origemCanal=MANUAL, se externalCallId tambem for enviado, os valores devem coincidir.
            Com origemCanal omitida e externalCallId presente, a chave do header tambem deve coincidir com externalCallId.
            Em canais automaticos (WHATSAPP, BINA_FIXO, TELEFONIA_FIXO), se sourceEventId for enviado, o valor do header deve coincidir com sourceEventId.
        - name: X-Idempotency-Key
          in: header
          required: false
          schema:
            type: string
            maxLength: 128
          description: |
            Alias de Idempotency-Key para atendimento manual.
            Quando ambos os headers sao enviados, devem possuir o mesmo valor.
            Em origemCanal=MANUAL, se externalCallId tambem for enviado, os valores devem coincidir.
            Com origemCanal omitida e externalCallId presente, a chave do header tambem deve coincidir com externalCallId.
            Em canais automaticos (WHATSAPP, BINA_FIXO, TELEFONIA_FIXO), se sourceEventId for enviado, o valor do header deve coincidir com sourceEventId.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AtendimentoRequest'
      responses:
        '200':
          description: Pedido registrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AtendimentoResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/eventos:
    post:
      summary: Registrar evento operacional
      tags: [operacao]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventoRequest'
      responses:
        '200':
          description: Evento aplicado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventoResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/replanejamento/run:
    post:
      summary: Endpoint de replanejamento manual (desativado operacionalmente)
      tags: [operacao]
      responses:
        '409':
          description: Endpoint desativado para execucao manual
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/operacao/rotas/prontas/iniciar:
    post:
      summary: Iniciar proxima rota pronta de um entregador (one-click operacional)
      tags: [operacao]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IniciarRotaProntaRequest'
      responses:
        '200':
          description: Rota pronta iniciada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventoResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/pedidos/{pedidoId}/timeline:
    get:
      summary: Timeline de transicoes do pedido
      tags: [timeline]
      x-handoff-status: ready-handoff
      x-dependency: A2
      parameters:
        - name: pedidoId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Timeline retornada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimelineResponse'
        '404':
          description: Pedido nao encontrado

  /api/pedidos/{pedidoId}/execucao:
    get:
      summary: Estado de execucao atual do pedido
      tags: [operacao]
      parameters:
        - name: pedidoId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Estado operacional retornado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PedidoExecucaoResponse'
        '404':
          description: Pedido nao encontrado
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/entregadores/{entregadorId}/roteiro:
    get:
      summary: Roteiro operacional do entregador
      tags: [operacao]
      parameters:
        - name: entregadorId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Roteiro retornado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoteiroEntregadorResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/operacao/painel:
    get:
      summary: Painel consolidado do centro operacional
      tags: [operacao]
      responses:
        '200':
          description: Painel retornado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OperacaoPainelResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/operacao/eventos:
    get:
      summary: Feed operacional de eventos de dispatch
      tags: [operacao]
      parameters:
        - name: limite
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
      responses:
        '200':
          description: Feed operacional retornado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OperacaoEventosResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/operacao/mapa:
    get:
      summary: Leitura geografica operacional de rotas/paradas
      tags: [operacao]
      responses:
        '200':
          description: Mapa operacional retornado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OperacaoMapaResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/operacao/replanejamento/jobs:
    get:
      summary: Feed operacional de jobs de replanejamento do solver
      tags: [operacao]
      parameters:
        - name: limite
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
      responses:
        '200':
          description: Jobs de replanejamento retornados
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OperacaoReplanejamentoResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/operacao/replanejamento/jobs/{jobId}:
    get:
      summary: Detalhe de impacto operacional de um job de replanejamento
      tags: [operacao]
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detalhe do job retornado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OperacaoReplanejamentoJobDetalheResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/financeiro/clientes/{clienteId}/saldo:
    get:
      summary: Consultar saldo de vales
      tags: [financeiro]
      x-handoff-status: pending-handoff
      x-dependency: A3
      parameters:
        - name: clienteId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Saldo retornado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaldoResponse'

  /api/financeiro/clientes/{clienteId}/extrato:
    get:
      summary: Consultar extrato de vales
      tags: [financeiro]
      x-handoff-status: pending-handoff
      x-dependency: A3
      parameters:
        - name: clienteId
          in: path
          required: true
          schema:
            type: integer
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Extrato retornado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtratoResponse'

  /api/financeiro/cobrancas/{pedidoId}:
    post:
      summary: Registrar quitacao de cobranca de cancelamento
      tags: [financeiro]
      x-handoff-status: pending-handoff
      x-dependency: A3
      parameters:
        - name: pedidoId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                valorCentavos:
                  type: integer
                registradoPor:
                  type: integer
              required: [valorCentavos, registradoPor]
      responses:
        '200':
          description: Cobranca atualizada

  /api/dispatch/stream:
    get:
      summary: Stream de eventos operacionais (SSE)
      tags: [dispatch]
      x-handoff-status: pending-handoff
      x-dependency: A4
      responses:
        '200':
          description: Stream de eventos
          content:
            text/event-stream:
              schema:
                type: string

  /api/produto/pedidos:
    get:
      summary: Lista paginada de pedidos para produto externo
      tags: [produto]
      x-handoff-status: pending-handoff
      x-dependency: A5
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          required: false
          schema:
            type: integer
            default: 20
        - name: status
          in: query
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Lista paginada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PedidoPageResponse'

components:
  schemas:
    AtendimentoRequest:
      type: object
      properties:
        externalCallId:
          type: string
          maxLength: 64
          description: |
            Legado para integracao telefonica.
            Em canais automaticos, quando enviado sem sourceEventId, sera usado como chave de idempotencia.
            Em origemCanal=MANUAL, funciona como fallback de manualRequestId quando manualRequestId nao for enviado.
            Quando enviado junto com sourceEventId ou manualRequestId, deve ter o mesmo valor da chave correspondente.
            Com origemCanal omitida, se Idempotency-Key/X-Idempotency-Key for enviado, os valores devem coincidir.
        sourceEventId:
          type: string
          maxLength: 128
          description: |
            Chave de idempotencia do evento no canal de origem.
            Obrigatorio quando origemCanal for WHATSAPP, BINA_FIXO ou TELEFONIA_FIXO.
            Nao pode ser usado quando origemCanal for MANUAL.
            Se externalCallId tambem for enviado, os valores devem ser iguais.
            Se Idempotency-Key/X-Idempotency-Key tambem for enviado, os valores devem ser iguais.
        manualRequestId:
          type: string
          maxLength: 128
          description: |
            Chave idempotente opcional para retries de atendimento manual (UI/operador).
            Nao pode ser usada em canais automaticos.
            Se externalCallId tambem for enviado, os valores devem ser iguais.
        origemCanal:
          type: string
          enum: [MANUAL, WHATSAPP, BINA_FIXO, TELEFONIA_FIXO]
          description: |
            Opcional.
            Se omitido e sourceEventId for informado, a API assume TELEFONIA_FIXO.
            Se omitido e nao houver sourceEventId/externalCallId, a API assume MANUAL.
        telefone:
          type: string
        quantidadeGaloes:
          type: integer
          minimum: 1
        atendenteId:
          type: integer
          minimum: 1
        metodoPagamento:
          type: string
          enum: [NAO_INFORMADO, DINHEIRO, PIX, CARTAO, VALE]
          description: Opcional. Quando VALE, o checkout so e aceito se o cliente tiver saldo suficiente.
        janelaTipo:
          type: string
          enum: [ASAP, HARD, FLEXIVEL]
          description: |
            Opcional. ASAP/FLEXIVEL representa janela flexivel; HARD exige horario de inicio/fim.
        janelaInicio:
          type: string
          pattern: '^([01][0-9]|2[0-3]):[0-5][0-9]$'
          description: Obrigatorio quando janelaTipo=HARD. Formato HH:mm.
        janelaFim:
          type: string
          pattern: '^([01][0-9]|2[0-3]):[0-5][0-9]$'
          description: Obrigatorio quando janelaTipo=HARD. Formato HH:mm.
        nomeCliente:
          type: string
          description: Opcional. Usado para criar/atualizar cadastro quando o telefone ainda nao existir.
        endereco:
          type: string
          description: Opcional. Quando informado junto com latitude/longitude, habilita criacao completa do cadastro.
        latitude:
          type: number
          format: double
          description: Opcional. Deve ser enviado junto com longitude.
        longitude:
          type: number
          format: double
          description: Opcional. Deve ser enviado junto com latitude.
      required: [telefone, quantidadeGaloes, atendenteId]

    AtendimentoResponse:
      type: object
      properties:
        pedidoId:
          type: integer
        clienteId:
          type: integer
        telefoneNormalizado:
          type: string
        clienteCriado:
          type: boolean
        idempotente:
          type: boolean
      required: [pedidoId, clienteId, telefoneNormalizado, clienteCriado, idempotente]

    EventoRequest:
      type: object
      properties:
        externalEventId:
          type: string
          maxLength: 128
          description: |
            Opcional no ciclo atual. Quando enviado, ativa deduplicacao forte por chave.
        eventType:
          type: string
          enum: [ROTA_INICIADA, PEDIDO_ENTREGUE, PEDIDO_FALHOU, PEDIDO_CANCELADO]
        rotaId:
          type: integer
        entregaId:
          type: integer
        actorEntregadorId:
          type: integer
          description: |
            Opcional. Quando informado, deve corresponder ao entregador dono da rota/entrega;
            em caso de divergencia o backend retorna 409.
        motivo:
          type: string
        cobrancaCancelamentoCentavos:
          type: integer
      required: [eventType]

    EventoResponse:
      type: object
      properties:
        evento:
          type: string
        rotaId:
          type: integer
        entregaId:
          type: integer
        pedidoId:
          type: integer
        idempotente:
          type: boolean
      required: [evento, rotaId, entregaId, pedidoId, idempotente]

    ReplanejamentoRequest:
      type: object
      properties:
        debounceSegundos:
          type: integer
          minimum: 0
          default: 20
        limiteEventos:
          type: integer
          minimum: 1
          default: 100

    ReplanejamentoResponse:
      type: object
      properties:
        eventosProcessados:
          type: integer
        replanejou:
          type: boolean
        rotasCriadas:
          type: integer
        entregasCriadas:
          type: integer
        pedidosNaoAtendidos:
          type: integer
      required:
        [eventosProcessados, replanejou, rotasCriadas, entregasCriadas, pedidosNaoAtendidos]

    IniciarRotaProntaRequest:
      type: object
      properties:
        entregadorId:
          type: integer
          minimum: 1
      required: [entregadorId]

    TimelineEvent:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        deStatus:
          type: string
        paraStatus:
          type: string
        origem:
          type: string
        observacao:
          type: string
      required: [timestamp, deStatus, paraStatus, origem]

    TimelineResponse:
      type: object
      properties:
        pedidoId:
          type: integer
        statusAtual:
          type: string
        eventos:
          type: array
          items:
            $ref: '#/components/schemas/TimelineEvent'
      required: [pedidoId, statusAtual, eventos]

    PedidoExecucaoResponse:
      type: object
      properties:
        pedidoId:
          type: integer
        rotaPrimariaId:
          type: integer
          nullable: true
        entregaAtivaId:
          type: integer
          nullable: true
        statusPedido:
          type: string
        camada:
          type: string
        rotaId:
          type: integer
          nullable: true
        entregaId:
          type: integer
          nullable: true
      required: [pedidoId, rotaPrimariaId, entregaAtivaId, statusPedido, camada, rotaId, entregaId]

    RoteiroRotaResumo:
      type: object
      properties:
        rotaId:
          type: integer
        status:
          type: string
      required: [rotaId, status]

    RoteiroParada:
      type: object
      properties:
        entregaId:
          type: integer
        pedidoId:
          type: integer
        ordemNaRota:
          type: integer
        status:
          type: string
        quantidadeGaloes:
          type: integer
        clienteNome:
          type: string
      required: [entregaId, pedidoId, ordemNaRota, status, quantidadeGaloes, clienteNome]

    RoteiroEntregadorResponse:
      type: object
      properties:
        entregadorId:
          type: integer
        rota:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/RoteiroRotaResumo'
        cargaRemanescente:
          type: integer
        paradasPendentesExecucao:
          type: array
          items:
            $ref: '#/components/schemas/RoteiroParada'
        paradasConcluidas:
          type: array
          items:
            $ref: '#/components/schemas/RoteiroParada'
      required: [entregadorId, rota, cargaRemanescente, paradasPendentesExecucao, paradasConcluidas]

    OperacaoPainelPedidosPorStatus:
      type: object
      properties:
        pendente:
          type: integer
        confirmado:
          type: integer
        emRota:
          type: integer
        entregue:
          type: integer
        cancelado:
          type: integer
      required: [pendente, confirmado, emRota, entregue, cancelado]

    OperacaoPainelRotaEmAndamento:
      type: object
      properties:
        rotaId:
          type: integer
        entregadorId:
          type: integer
        pendentes:
          type: integer
        emExecucao:
          type: integer
      required: [rotaId, entregadorId, pendentes, emExecucao]

    OperacaoPainelRotaPlanejada:
      type: object
      properties:
        rotaId:
          type: integer
        entregadorId:
          type: integer
        pendentes:
          type: integer
      required: [rotaId, entregadorId, pendentes]

    OperacaoPainelPendenteElegivel:
      type: object
      properties:
        pedidoId:
          type: integer
        criadoEm:
          type: string
          format: date-time
        quantidadeGaloes:
          type: integer
        janelaTipo:
          type: string
      required: [pedidoId, criadoEm, quantidadeGaloes, janelaTipo]

    OperacaoPainelConfirmadoSecundaria:
      type: object
      properties:
        pedidoId:
          type: integer
        rotaId:
          type: integer
        ordemNaRota:
          type: integer
        entregadorId:
          type: integer
        quantidadeGaloes:
          type: integer
      required: [pedidoId, rotaId, ordemNaRota, entregadorId, quantidadeGaloes]

    OperacaoPainelEmRotaPrimaria:
      type: object
      properties:
        pedidoId:
          type: integer
        rotaId:
          type: integer
        entregaId:
          type: integer
        entregadorId:
          type: integer
        quantidadeGaloes:
          type: integer
        statusEntrega:
          type: string
      required: [pedidoId, rotaId, entregaId, entregadorId, quantidadeGaloes, statusEntrega]

    OperacaoPainelResponse:
      type: object
      properties:
        atualizadoEm:
          type: string
          format: date-time
        ambiente:
          type: string
        pedidosPorStatus:
          $ref: '#/components/schemas/OperacaoPainelPedidosPorStatus'
        rotas:
          type: object
          properties:
            emAndamento:
              type: array
              items:
                $ref: '#/components/schemas/OperacaoPainelRotaEmAndamento'
            planejadas:
              type: array
              items:
                $ref: '#/components/schemas/OperacaoPainelRotaPlanejada'
          required: [emAndamento, planejadas]
        filas:
          type: object
          properties:
            pendentesElegiveis:
              type: array
              items:
                $ref: '#/components/schemas/OperacaoPainelPendenteElegivel'
            confirmadosSecundaria:
              type: array
              items:
                $ref: '#/components/schemas/OperacaoPainelConfirmadoSecundaria'
            emRotaPrimaria:
              type: array
              items:
                $ref: '#/components/schemas/OperacaoPainelEmRotaPrimaria'
          required: [pendentesElegiveis, confirmadosSecundaria, emRotaPrimaria]
      required: [atualizadoEm, ambiente, pedidosPorStatus, rotas, filas]

    OperacaoEventoItem:
      type: object
      properties:
        id:
          type: integer
        eventType:
          type: string
        status:
          type: string
        aggregateType:
          type: string
        aggregateId:
          type: integer
          nullable: true
        payload:
          type: object
          additionalProperties: true
        createdEm:
          type: string
          format: date-time
        processedEm:
          type: string
          format: date-time
          nullable: true
      required: [id, eventType, status, aggregateType, aggregateId, payload, createdEm, processedEm]

    OperacaoEventosResponse:
      type: object
      properties:
        eventos:
          type: array
          items:
            $ref: '#/components/schemas/OperacaoEventoItem'
      required: [eventos]

    OperacaoMapaDeposito:
      type: object
      properties:
        lat:
          type: number
        lon:
          type: number
      required: [lat, lon]

    OperacaoMapaParada:
      type: object
      properties:
        pedidoId:
          type: integer
        entregaId:
          type: integer
        ordemNaRota:
          type: integer
        statusEntrega:
          type: string
        quantidadeGaloes:
          type: integer
        lat:
          type: number
        lon:
          type: number
      required: [pedidoId, entregaId, ordemNaRota, statusEntrega, quantidadeGaloes, lat, lon]

    OperacaoMapaPonto:
      type: object
      properties:
        tipo:
          type: string
          enum: [DEPOSITO, PARADA]
        pedidoId:
          type: integer
          nullable: true
        entregaId:
          type: integer
          nullable: true
        ordemNaRota:
          type: integer
          nullable: true
        lat:
          type: number
        lon:
          type: number
      required: [tipo, lat, lon]

    OperacaoMapaRota:
      type: object
      properties:
        rotaId:
          type: integer
        entregadorId:
          type: integer
        statusRota:
          type: string
        camada:
          type: string
        paradas:
          type: array
          items:
            $ref: '#/components/schemas/OperacaoMapaParada'
        trajeto:
          type: array
          description: Sequencia geografica da rota (deposito -> paradas -> deposito).
          items:
            $ref: '#/components/schemas/OperacaoMapaPonto'
      required: [rotaId, entregadorId, statusRota, camada, paradas, trajeto]

    OperacaoMapaResponse:
      type: object
      properties:
        atualizadoEm:
          type: string
          format: date-time
        ambiente:
          type: string
        deposito:
          $ref: '#/components/schemas/OperacaoMapaDeposito'
        rotas:
          type: array
          items:
            $ref: '#/components/schemas/OperacaoMapaRota'
      required: [atualizadoEm, ambiente, deposito, rotas]

    OperacaoReplanejamentoJob:
      type: object
      properties:
        jobId:
          type: string
        planVersion:
          type: integer
        status:
          type: string
        cancelRequested:
          type: boolean
        solicitadoEm:
          type: string
          format: date-time
        iniciadoEm:
          type: string
          format: date-time
          nullable: true
        finalizadoEm:
          type: string
          format: date-time
          nullable: true
        erro:
          type: string
          nullable: true
        hasRequestPayload:
          type: boolean
        hasResponsePayload:
          type: boolean
      required:
        [jobId, planVersion, status, cancelRequested, solicitadoEm, iniciadoEm, finalizadoEm, erro, hasRequestPayload, hasResponsePayload]

    OperacaoReplanejamentoResponse:
      type: object
      properties:
        atualizadoEm:
          type: string
          format: date-time
        ambiente:
          type: string
        habilitado:
          type: boolean
        jobs:
          type: array
          items:
            $ref: '#/components/schemas/OperacaoReplanejamentoJob'
      required: [atualizadoEm, ambiente, habilitado, jobs]

    OperacaoReplanejamentoRotaImpactada:
      type: object
      properties:
        rotaId:
          type: integer
        entregadorId:
          type: integer
        statusRota:
          type: string
        camada:
          type: string
        totalEntregas:
          type: integer
      required: [rotaId, entregadorId, statusRota, camada, totalEntregas]

    OperacaoReplanejamentoPedidoImpactado:
      type: object
      properties:
        pedidoId:
          type: integer
        entregaId:
          type: integer
        rotaId:
          type: integer
        statusPedido:
          type: string
        statusEntrega:
          type: string
      required: [pedidoId, entregaId, rotaId, statusPedido, statusEntrega]

    OperacaoReplanejamentoJobDetalhe:
      type: object
      properties:
        jobId:
          type: string
        planVersion:
          type: integer
        status:
          type: string
        cancelRequested:
          type: boolean
        solicitadoEm:
          type: string
          format: date-time
        iniciadoEm:
          type: string
          format: date-time
          nullable: true
        finalizadoEm:
          type: string
          format: date-time
          nullable: true
        erro:
          type: string
          nullable: true
        hasRequestPayload:
          type: boolean
        hasResponsePayload:
          type: boolean
        rotasImpactadas:
          type: array
          items:
            $ref: '#/components/schemas/OperacaoReplanejamentoRotaImpactada'
        pedidosImpactados:
          type: array
          items:
            $ref: '#/components/schemas/OperacaoReplanejamentoPedidoImpactado'
      required:
        [jobId, planVersion, status, cancelRequested, solicitadoEm, iniciadoEm, finalizadoEm, erro, hasRequestPayload, hasResponsePayload, rotasImpactadas, pedidosImpactados]

    OperacaoReplanejamentoJobDetalheResponse:
      type: object
      properties:
        atualizadoEm:
          type: string
          format: date-time
        ambiente:
          type: string
        habilitado:
          type: boolean
        job:
          $ref: '#/components/schemas/OperacaoReplanejamentoJobDetalhe'
      required: [atualizadoEm, ambiente, habilitado, job]

    SaldoResponse:
      type: object
      properties:
        clienteId:
          type: integer
        quantidade:
          type: integer
      required: [clienteId, quantidade]

    ExtratoItem:
      type: object
      properties:
        data:
          type: string
          format: date-time
        tipo:
          type: string
          enum: [CREDITO, DEBITO]
        quantidade:
          type: integer
        saldoApos:
          type: integer
        registradoPor:
          type: string
        pedidoId:
          type: integer
        observacao:
          type: string
      required: [data, tipo, quantidade, saldoApos, registradoPor]

    ExtratoResponse:
      type: object
      properties:
        clienteId:
          type: integer
        itens:
          type: array
          items:
            $ref: '#/components/schemas/ExtratoItem'
      required: [clienteId, itens]

    PedidoResumo:
      type: object
      properties:
        pedidoId:
          type: integer
        clienteNome:
          type: string
        status:
          type: string
        criadoEm:
          type: string
          format: date-time
      required: [pedidoId, clienteNome, status, criadoEm]

    PedidoPageResponse:
      type: object
      properties:
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
        itens:
          type: array
          items:
            $ref: '#/components/schemas/PedidoResumo'
      required: [page, pageSize, total, itens]

    ErrorResponse:
      type: object
      properties:
        erro:
          type: string
        detalhe:
          type: string
      required: [erro]

  responses:
    BadRequest:
      description: Requisicao invalida
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflito de estado ou regra de negocio
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalError:
      description: Erro interno
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
